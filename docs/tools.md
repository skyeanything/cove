# AI 工具文档

Cove 内置 8 个 AI 工具，在对话过程中模型可自动调用。工具通过 `src/lib/ai/tools/index.ts` 注册，并由 `getAgentTools()` 按启用配置动态装配。

---

## `read` — 读取文件

读取工作区内指定文件的内容，支持文本文件。

**参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| `path` | `string` | 相对于工作区根目录的文件路径 |

**使用场景**

- 查看代码文件内容
- 读取配置文件
- 检查日志文件

---

## `write` — 写入文件

创建新文件或完全覆盖已有文件。

**参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| `path` | `string` | 目标文件路径（相对工作区） |
| `content` | `string` | 写入的完整文件内容 |

**使用场景**

- 生成新文件（脚本、配置、文档）
- 完整替换文件内容

---

## `edit` — 精准编辑

在文件中查找 `old_string` 并替换为 `new_string`，适合局部修改，避免重写整个文件。

**参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| `path` | `string` | 目标文件路径 |
| `old_string` | `string` | 要替换的原始内容（需在文件中唯一） |
| `new_string` | `string` | 替换后的新内容 |

**使用场景**

- 修复代码中的 bug
- 更新配置项
- 重命名变量 / 函数

> **注意**：`old_string` 必须在文件中唯一出现，否则操作会失败并提示提供更多上下文。

---

## `bash` — 执行命令

在工作区目录下执行 shell 命令。内置安全分级，危险操作需用户确认。

**参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| `command` | `string` | 要执行的 shell 命令 |

**安全分级**

| 级别 | 示例 | 行为 |
|------|------|------|
| `safe` | `ls`、`cat`、`grep` | 直接执行 |
| `confirm` | `rm`、`mv`、`git push` | 弹出确认对话框 |
| `block` | `sudo`、`chmod 777` | 拒绝执行 |

**使用场景**

- 运行测试（`npm test`、`cargo test`）
- 构建项目（`pnpm build`）
- 查询 git 状态
- 安装依赖

---

## `fetch_url` — 获取网页

通过 Rust 后端抓取网页内容（绕过浏览器跨域限制），并提取主要文本。

**参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| `url` | `string` | 目标网页 URL |

**使用场景**

- 查阅在线文档
- 获取 API 参考
- 搜索结果内容提取

---

## `parse_document` — 解析文档

解析上传的 PDF、DOCX、PPTX 或 XLSX 附件，提取文本内容供模型分析。

**参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| `attachmentId` | `string` | 已上传附件的 ID（由会话消息中的附件清单提供） |
| `mode` | `"full"｜"summary"｜"chunks"` | 返回模式（可选，默认 `full`） |
| `pageRange` | `string?` | PDF 页码范围，如 `1-3,5`（可选） |

**支持格式**

- `PDF` — 提取全文内容
- `DOCX` — 提取段落与表格
- `PPTX` — 提取幻灯片文本
- `XLSX` — 提取工作表数据

**使用场景**

- 分析合同或报告
- 总结演示文稿
- 处理表格数据

---

## `skill` — 执行技能

加载并执行预定义的领域技能，实现复杂的多步骤任务。

**参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| `name` | `string` | 技能名称（已启用的技能之一） |

**内置技能**

| 技能 | 功能 |
|------|------|
| `officellm` | 通过自然语言操作 Office 文档 |
| `web-research` | 多步骤网络研究与信息整合 |

**自定义技能**

将技能文件放置于技能目录，Cove 会通过 `skill_discovery.rs` 自动发现并注册。

---

## `officellm` — Office 文档操作

通过集成的 officellm 进程，对本地 Office 文档（DOCX / PPTX / XLSX）执行程序化命令。

**参数**

| 参数 | 类型 | 说明 |
|------|------|------|
| `action` | `string` | 操作类型（见下表） |
| `path` | `string?` | 文档路径（`open` 时必填；`save` 时可选，表示另存为） |
| `command` | `string?` | 命令名称（`call` 时必填，如 `addSlide`、`setText`） |
| `args` | `object?` | 命令参数键值对（`call` 时可选） |

**支持的 action**

| action | 说明 |
|--------|------|
| `detect` | 检测本地是否已安装 officellm |
| `open` | 打开指定路径的 Office 文档，建立会话 |
| `call` | 对已打开的文档执行命令（需提供 `command`） |
| `save` | 保存当前文档（提供 `path` 则另存为） |
| `close` | 关闭当前会话 |
| `status` | 查询当前会话状态（文档路径、PID、运行时长） |

**示例：在 PowerPoint 添加一张幻灯片**

```json
{ "action": "call", "command": "addSlide", "args": { "title": "新章节" } }
```

> **注意**：需要本地已安装 officellm 并配置好对应的 Office 环境。
