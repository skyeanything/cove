@import "tailwindcss";
@import "prismjs/themes/prism-tomorrow.css";

@custom-variant dark (&:is(.dark *));

@theme {
  /* ===== shadcn/ui standard tokens (light) ===== */
  --color-background: #ffffff;
  --color-foreground: #09090b;

  --color-card: #ffffff;
  --color-card-foreground: #09090b;

  --color-popover: #ffffff;
  --color-popover-foreground: #09090b;

  --color-primary: #18181b;
  --color-primary-foreground: #fafafa;

  --color-secondary: #f4f4f5;
  --color-secondary-foreground: #18181b;

  --color-muted: #f4f4f5;
  --color-muted-foreground: #71717a;

  --color-accent: #f4f4f5;
  --color-accent-foreground: #18181b;

  --color-destructive: #ef4444;
  --color-destructive-foreground: #ffffff;

  --color-border: #e4e4e7;
  --color-input: #e4e4e7;
  --color-ring: #18181b;

  /* ===== Extended custom tokens (light) ===== */
  --color-background-secondary: #f9fafb;
  --color-background-tertiary: #f4f4f5;

  --color-foreground-secondary: #71717a;
  --color-foreground-tertiary: #a1a1aa;

  --color-border-subtle: #f4f4f5;

  --color-brand: #2563eb;
  --color-brand-hover: #1d4ed8;
  --color-brand-foreground: #ffffff;
  --color-brand-muted: #dbeafe;

  --color-success: #10b981;
  --color-warning: #f59e0b;

  --color-sidebar: #fafafa;
  --color-sidebar-foreground: #09090b;
  --color-sidebar-border: #e4e4e7;
  --color-sidebar-accent: #f4f4f5;
  --color-sidebar-accent-foreground: #18181b;
  --color-sidebar-ring: #18181b;

  /* Typography */
  --font-sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", sans-serif;
  --font-mono: "SF Mono", "Cascadia Code", "Fira Code", ui-monospace, monospace;
  /* 文件预览区（目录树 + 代码）使用 Rubik */
  --font-preview: "Rubik", var(--font-sans);

  /* Radii */
  --radius-sm: 6px;
  --radius-md: 8px;
  --radius-lg: 10px;
  --radius-xl: 12px;

  /* Animations */
  --animate-slide-in: slide-in 200ms ease-out;
  --animate-slide-out: slide-out 150ms ease-in;
  --animate-fade-in: fade-in 150ms ease-out;
  --animate-accordion-down: accordion-down 200ms ease-out;
  --animate-accordion-up: accordion-up 200ms ease-out;

  @keyframes slide-in {
    from { opacity: 0; transform: translateX(-8px); }
    to { opacity: 1; transform: translateX(0); }
  }

  @keyframes slide-out {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(-8px); }
  }

  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes accordion-down {
    from { height: 0; }
    to { height: var(--radix-accordion-content-height); }
  }

  @keyframes accordion-up {
    from { height: var(--radix-accordion-content-height); }
    to { height: 0; }
  }
}

/* ===== Dark mode ===== */
.dark {
  --color-background: #09090b;
  --color-foreground: #fafafa;

  --color-card: #09090b;
  --color-card-foreground: #fafafa;

  --color-popover: #09090b;
  --color-popover-foreground: #fafafa;

  --color-primary: #fafafa;
  --color-primary-foreground: #18181b;

  --color-secondary: #27272a;
  --color-secondary-foreground: #fafafa;

  --color-muted: #27272a;
  --color-muted-foreground: #a1a1aa;

  --color-accent: #27272a;
  --color-accent-foreground: #fafafa;

  --color-destructive: #ef4444;
  --color-destructive-foreground: #ffffff;

  --color-border: #27272a;
  --color-input: #27272a;
  --color-ring: #d4d4d8;

  /* Extended */
  --color-background-secondary: #111113;
  --color-background-tertiary: #18181b;

  --color-foreground-secondary: #a1a1aa;
  --color-foreground-tertiary: #52525b;

  --color-border-subtle: #1c1c1f;

  --color-brand: #3b82f6;
  --color-brand-hover: #60a5fa;
  --color-brand-foreground: #ffffff;
  --color-brand-muted: #1e3a5f;

  --color-sidebar: #0f0f12;
  --color-sidebar-foreground: #fafafa;
  --color-sidebar-border: #27272a;
  --color-sidebar-accent: #27272a;
  --color-sidebar-accent-foreground: #fafafa;
  --color-sidebar-ring: #d4d4d8;
}

/* ===== Base ===== */
*,
*::before,
*::after {
  border-color: var(--color-border);
}

html {
  font-size: 14px;
}

body {
  font-family: var(--font-sans);
  background-color: var(--color-background);
  color: var(--color-foreground);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow: hidden;
  margin: 0;
}

/* 隐藏滚动条（保留滚动能力） */
* {
  scrollbar-width: none;
}

::-webkit-scrollbar {
  width: 0;
  height: 0;
  display: none;
}

::-webkit-scrollbar-track {
  background: transparent;
}

/* Radix ScrollArea 的自定义滚动条一并隐藏 */
[data-slot="scroll-area-scrollbar"] {
  display: none;
}

/* Non-selectable UI chrome */
.no-select {
  user-select: none;
  -webkit-user-select: none;
}

/* Titlebar drag region — cursor hint */
[data-tauri-drag-region] {
  cursor: default;
}

/* 打字机光标：柔和呼吸感，避免 step-end 造成的刺眼闪烁 */
@keyframes cursor-blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.35; }
}
.cursor-blink {
  animation: cursor-blink 1.2s ease-in-out infinite;
}

/* Markdown 渲染完成后的淡入；流式输出时禁用避免每次增量都闪一下 */
[data-md] {
  animation: fade-in 0.2s ease-out;
}
.streaming-content [data-md] {
  animation: none;
}

.streaming-content {
  animation: none;
}

/* 每个 event 追加时的短暂高亮 */
@keyframes streaming-append {
  from { opacity: 0.97; }
  to { opacity: 1; }
}
.streaming-just-appended {
  animation: streaming-append 0.12s ease-out;
}

/* 代码块正文颜色改为绿色（覆盖 Prism 主题中的蓝色等） */
[data-md] pre .token,
[data-md] pre code,
[data-md] pre code .token {
  color: var(--color-success) !important;
}

/* ===== 文件预览：目录树与代码区使用 Rubik，代码主题加深 ===== */
.file-preview-tree {
  font-family: var(--font-preview);
}
.file-preview-header-path {
  font-family: var(--font-preview);
}
.file-preview-code {
  font-family: var(--font-preview);
}
/* 行号颜色加深 */
.file-preview-code .file-preview-line-num {
  color: var(--color-foreground-tertiary);
}
.dark .file-preview-code .file-preview-line-num {
  color: var(--color-foreground-tertiary);
}
/* 代码预览语法高亮加深（仅文件预览区，不影响 Markdown 内代码块） */
.file-preview-code .token.comment,
.file-preview-code .token.block-comment,
.file-preview-code .token.prolog,
.file-preview-code .token.doctype,
.file-preview-code .token.cdata {
  color: #6b7280;
}
.file-preview-code .token.punctuation {
  color: var(--color-foreground);
}
.file-preview-code .token.keyword,
.file-preview-code .token.builtin {
  color: #1d4ed8;
}
.file-preview-code .token.string,
.file-preview-code .token.char,
.file-preview-code .token.attr-value {
  color: #b45309;
}
.file-preview-code .token.number,
.file-preview-code .token.boolean,
.file-preview-code .token.function {
  color: #c2410c;
}
.file-preview-code .token.property,
.file-preview-code .token.class-name,
.file-preview-code .token.constant,
.file-preview-code .token.symbol {
  color: #a16207;
}
.file-preview-code .token.tag,
.file-preview-code .token.attr-name,
.file-preview-code .token.selector,
.file-preview-code .token.atrule {
  color: #7c3aed;
}
.file-preview-code .token.operator,
.file-preview-code .token.entity,
.file-preview-code .token.url {
  color: #0d9488;
}
.file-preview-code .token.function-name {
  color: #0369a1;
}
.dark .file-preview-code .token.comment,
.dark .file-preview-code .token.block-comment,
.dark .file-preview-code .token.prolog,
.dark .file-preview-code .token.doctype,
.dark .file-preview-code .token.cdata {
  color: #a1a1aa;
}
.dark .file-preview-code .token.punctuation {
  color: #d4d4d8;
}
.dark .file-preview-code .token.keyword,
.dark .file-preview-code .token.builtin {
  color: #93c5fd;
}
.dark .file-preview-code .token.string,
.dark .file-preview-code .token.char,
.dark .file-preview-code .token.attr-value {
  color: #fcd34d;
}
.dark .file-preview-code .token.number,
.dark .file-preview-code .token.boolean,
.dark .file-preview-code .token.function {
  color: #fdba74;
}
.dark .file-preview-code .token.property,
.dark .file-preview-code .token.class-name,
.dark .file-preview-code .token.constant,
.dark .file-preview-code .token.symbol {
  color: #fde047;
}
.dark .file-preview-code .token.tag,
.dark .file-preview-code .token.attr-name,
.dark .file-preview-code .token.selector,
.dark .file-preview-code .token.atrule {
  color: #c4b5fd;
}
.dark .file-preview-code .token.operator,
.dark .file-preview-code .token.entity,
.dark .file-preview-code .token.url {
  color: #5eead4;
}
.dark .file-preview-code .token.function-name {
  color: #7dd3fc;
}
.dark .file-preview-code .file-preview-line-num {
  color: var(--color-foreground-tertiary);
}

/*
 * DOCX 分页预览
 *
 * docx-preview 原生分页（breakPages:true + ignoreLastRenderedPageBreak:false）
 * 每页生成一个 <section class="docx">，库自动排版不会切割文字。
 * 覆盖库的默认样式，适配我们的主题色和暗色模式。
 */

/* 滚动容器 */
.docx-render-area {
  background: var(--color-background-tertiary, #f3f4f6);
}
.dark .docx-render-area {
  background: var(--color-background-secondary, #0f0f12);
}

/* 覆盖库注入的 .docx-wrapper 灰色背景 */
.docx-render-area .docx-wrapper {
  background: var(--color-background-tertiary, #f3f4f6) !important;
  padding: 24px 30px !important;
}
.dark .docx-render-area .docx-wrapper {
  background: var(--color-background-secondary, #0f0f12) !important;
}

/* 每页白卡片 */
.docx-render-area .docx-wrapper > section.docx {
  background: var(--color-background, #fff) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 0 1px rgba(0, 0, 0, 0.1) !important;
  border-radius: 4px;
  margin-bottom: 24px !important;
}
.dark .docx-render-area .docx-wrapper > section.docx {
  background: var(--color-background, #09090b) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 1px rgba(255, 255, 255, 0.05) !important;
}

/* 页码角标 */
.docx-page-number {
  position: absolute;
  bottom: 16px;
  right: 20px;
  font-size: 12px;
  color: var(--color-foreground-tertiary, #9ca3af);
  background: var(--color-background-tertiary, #f3f4f6);
  border-radius: 6px;
  padding: 2px 10px;
  line-height: 1.6;
  pointer-events: none;
  user-select: none;
  z-index: 2;
}
.dark .docx-page-number {
  background: var(--color-background-secondary, #18181b);
}
